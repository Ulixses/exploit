#!/bin/bash

# Basic  Nmap based SMB protocol sanner for CVE-2020-0796 detection

if [ $# -eq 0 ]
then
echo $'Usage:\n\tCVE-2020-0796_scan.sh TARGET_IP or RANGE'
exit 1
fi
echo "Checking SMB v3.11 protocol against" $1 "..."

SMBVersion=$(nmap -p445 --script smb-protocols -Pn -n $1  | grep -P '\d+\.\d+\.\d+\.\d+|^\|.\s+3.11' | tr '\n' ' ' | replace 'Nmap scan report for' '@' | tr "@" "\n" | grep 3.11 | tr '|' ' ' | tr '_' ' ')

if [[ $SMBVersion =~ 3.11 ]]; then
echo "Microsoft Server Message Block 3.1.1 (SMBv3) protocol detected - Target is VULNERABLE"

else
echo "There's no SMB v3.11 in use - Target is NOT vulnerable"
fi

